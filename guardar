import { GetStaticProps } from 'next'
import Head from 'next/head'
import Image from 'next/image'
import { api } from '../services/api'
import styles from './home.module.scss'

type Asset = {
  id: number;
  name: string;
  image: string;
  status: string;
  healthscore: number;
  unitId: number;
  companyId: number;
}

type HomeProps = {
  assets : Asset[];
}

export default function Home({ assets }: HomeProps) {
  return (
    <div className={styles.container}>
      <Head>
        <title>Tractian</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className={styles.main}>
        <h1>Todos Sensores</h1>
        <section className={styles.allAssets}>
          <table>
            <thead>
              <tr>
                <th></th>
                <th>Nome</th>
              </tr>
            </thead>

            <tbody>
              {assets.map((asset, index) => {
                return (
                  <tr>
                    <td>
                      <Image />
                    </td>
                    <td>
                      <Link>
                        <a href=""></a>
                      </Link>
                    </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                      <button>
                        <img src="" alt="" />
                      </button>
                    </td>
                  </tr>
                )
              })}
            </tbody>
          </table>
        </section>
      </main>

      <footer className={styles.footer}>S
      </footer>
    </div>
  )
}

export const getStaticProps: GetStaticProps = async () => {
  const { data } = await api.get('assets', {
    params: {
      _sort: 'lastUptimeAt',
      _order: 'desc'
    }
  })

  const assets = data.map(asset => {
    return{
      id: asset.id,
      name: asset.name,
      image: asset.image,
      status: asset.status,
      healthscore: asset.healthscore,
      unitId: asset.unitId,
      companyId: asset.companyId,
    };
  })

  return {
    props: {
      assets,
    },
      revalidate: 60 * 60 * 8,
  }
}
